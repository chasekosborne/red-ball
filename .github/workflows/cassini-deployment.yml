name: Deploy to Cassini

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo (not strictly needed for remote-only deploy, but harmless)
        uses: actions/checkout@v4

      # Install SSH key so we can ssh into cassini
      - name: Install SSH key
        uses: shimataro/ssh-key-action@v2
        with:
          # private key that can log into cassini (public part is in ~/.ssh/authorized_keys on cassini)
          key: ${{ secrets.CASSINI_SSH_KEY }}
          # output of: ssh-keyscan cassini.cs.kent.edu
          known_hosts: ${{ secrets.KNOWN_HOSTS }}

      - name: Update code on remote server
        run: |
          ssh redball@cassini.cs.kent.edu '
            set -e
            cd red-ball/    # path to the repo on the server
            git pull                      # get latest changes
          '
